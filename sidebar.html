{if isset($category)}{$selected_category=$category.id}{else}{$selected_category=null}{/if}
{$categories = $wa->shop->categories(0, null, true)}
{if $categories}
<div class="box category">
    <div class="box-heading">Категории</div>
    <div class="box-content">
        <div class="box-category">
            {wa_print_tree tree=$categories selected=$selected_category unfolded=true collapsible_class='parent' class="menu-v category-tree" elem ='<a href=":url" title=":name">:name</a>'}
        </div>
    </div>
</div>
<div class="clear"></div>
{/if}


{if $wa->shop->pages()}
<div class="box category">
    <div class="box-heading">Информация</div>
    <div class="box-content">
        <div class="box-category">
            <!-- page tree -->
            {wa_print_tree tree=$wa->shop->pages() class="menu-v" attrs = 'id="page-list"' elem ='<a href=":url" title=":title">:name</a>' collapsible_class='parent' selected=$wa->param('page_id')}
        </div>
    </div>
</div>
{/if}

<!-- filtering by product features -->
{if !empty($filters)}
<div class="box man">
    <div class="box-heading"><span>Фильтр товаров</span></div>
    <div class="box-content">


        <div class="filters{if !empty($theme_settings.ajax_filters)} ajax{/if}">
            <form method="get" action="{$wa->currentUrl()}">
                {foreach $filters as $fid => $filter}
                <p>
                    {if $fid == 'price'}
                    {$c = $wa->shop->currency(true)}
                    <b>[`Price`]</b><br>
                    [`from`] <input type="text" name="price_min" {if $wa->get('price_min')}value="{(int)$wa->get('price_min')}"{/if} placeholder="0">
                    [`to`] <input type="text" name="price_max" {if $wa->get('price_max')}value="{(int)$wa->get('price_max')}"{/if} placeholder="&infin;"> {$c.sign}
                    {else}
                    <b>{$filter.name|escape}</b><br>
                    {if $filter.type == 'boolean'}
                    <label><input type="radio" name="{$filter.code}"{if $wa->get($filter.code)} checked{/if} value="1"> [`Yes`]</label><br>
                    <label><input type="radio" name="{$filter.code}"{if $wa->get($filter.code) === '0'} checked{/if} value="0"> [`No`]</label><br>
                    <label><input type="radio" name="{$filter.code}"{if $wa->get($filter.code, '') === ''} checked{/if} value=""> [`Any`]</label><br>
                    {else}
                    {foreach $filter.values as $v_id => $v}
                    <label>
                        <input type="checkbox" name="{$filter.code}[]" {if in_array($v_id, (array)$wa->get($filter.code, array()))}checked{/if} value="{$v_id}"> {$v}
                    </label><br>
                    {/foreach}
                    {/if}
                    {/if}
                </p>
                {/foreach}
                {if $wa->get('sort')}<input type="hidden" name="sort" value="{$wa->get('sort')|escape}">{/if}
                {if $wa->get('order')}<input type="hidden" name="order" value="{$wa->get('order')|escape}">{/if}
                <input class="button" type="submit" value="[`Filter products`]">
            </form>
        </div>

        <div class="clear"></div>
    </div>
</div>
{/if} 


{if $wa->blog && $wa->blog->posts()}
<div class="box man">
    <div class="box-heading"><span>Новости</span></div>
    <div class="box-content">
        {foreach $wa->blog->posts() as $post}
        <div class="short-post">
            <h3>
                <a href="{$post.link}">{$post.title}</a>
                {* @event prepare_posts_frontend.%plugin_id%.post_title *}
                {if !empty($post.plugins.post_title)}
                {foreach $post.plugins.post_title as $plugin => $output}{$output}{/foreach}
                {/if}
            </h3>
            <div class="credentials">
                {if $post.user.posts_link}
                <a href="{$post.user.posts_link}" class="username">{$post.user.name}</a>
                {else}
                <span class="username">{$post.user.name}</span>
                {/if}
                {$post.datetime|wa_datetime:"humandate"}
            </div>
            <p>
                {$post.text|strip_tags|truncate:400}
            </p>
        </div>
        {if $post@iteration == 3}{break}{/if}
        {/foreach}
        <div class="clear"></div>
    </div>
</div>
{/if}

{if $wa->photos && $wa->photos->photos()}
<div class="box man" id="last_photos">
    <div class="box-heading"><span>Последние фото</span></div>
    <div class="box-content">
        <ul class="view-thumbs">
            {foreach from=$wa->photos->photos() item=photo}
            <li{if $photo.stack_count > 0} class="stacked"{/if}>
                <div class="image">
                    {if empty($photo.frontend_link)}
                    {$wa->photos->getImgHtml($photo, "200x0", ["class"=>"shadowed"])}
                    {else}
                    <a href="{$photo.frontend_link|default:'#'}">
                        {$wa->photos->getImgHtml($photo, "200x0", ["class"=>"shadowed"])}
                    </a>
                    {/if}
                </div>
                <h5>{$photo.name}</h5>
                {if $photo.description}
                <p>{$photo.description}</p>
                {/if}
            </li>
            {if $photo@iteration == 3}{break}{/if}
            {/foreach}
        </ul>
        <div class="clear"></div>
    </div>
</div>
{/if}


<!-- tag cloud -->
{if $cloud = $wa->shop->tags()}
<div class="box man">
    <div class="box-heading"><span>Теги</span></div>
    <div class="box-content">
        <div class="tags">
            {foreach $cloud as $tag}
            <a href="{$wa_app_url}tag/{$tag.uri_name}/" style="font-size: {$tag.size}%; opacity: {$tag.opacity}">{$tag.name|escape}</a>
            {/foreach}
        </div>
        <div class="clear"></div>
    </div>
</div>
{/if}

<!-- plugin hook: 'frontend_nav' -->
{* @event frontend_nav.%plugin_id% *}
{foreach $frontend_nav as $_}{$_}{/foreach}
